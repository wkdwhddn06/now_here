# Firebase AI 배너 광고 설정 가이드

Firebase AI를 사용하여 채팅방 상단에 위치 기반 배너 광고를 자동 생성하는 기능을 구현했습니다.

## 🚀 기능 소개

- **AI 자동 생성**: Firebase Vertex AI (Gemini)를 사용하여 위치에 맞는 배너 광고 자동 생성
- **스마트 배너**: 장소 특성을 파악하여 맞춤형 제목, 설명, 색상, 아이콘 제공
- **자동 회전**: 여러 배너를 생성하여 5초마다 자동 회전
- **폴백 시스템**: AI 생성 실패시 템플릿 기반 기본 배너 제공

## 📋 Firebase 설정 필요사항

### 1. Firebase 프로젝트 설정

1. [Firebase Console](https://console.firebase.google.com/) 접속
2. 프로젝트 선택 또는 생성
3. 프로젝트 설정 → 일반 → 앱 추가 (이미 완료된 경우 건너뛰기)

### 2. Vertex AI API 활성화

1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. 프로젝트 선택
3. API 및 서비스 → 라이브러리
4. "Vertex AI API" 검색하여 활성화
5. 또는 다음 링크 사용: https://console.cloud.google.com/apis/api/aiplatform.googleapis.com

### 3. 결제 설정 (중요!)

⚠️ **Vertex AI는 유료 서비스입니다**

1. Google Cloud Console → 결제
2. 결제 계정 연결 (신용카드 등록 필요)
3. Blaze 요금제로 업그레이드 필요

### 4. API 키 설정 (선택사항)

프로젝트에서 `firebase_options.dart` 파일이 올바르게 설정되어 있는지 확인하세요.

## 🔧 코드 구조

### AI 배너 서비스
- `lib/service/ai_banner_service.dart`: Firebase Vertex AI를 사용한 배너 생성 로직
- `lib/ui/chat/widgets/ai_banner_widget.dart`: 배너 UI 위젯

### 주요 기능
1. **AI 프롬프트 엔지니어링**: 위치 기반 맞춤 배너 생성
2. **JSON 파싱**: AI 응답을 구조화된 데이터로 변환
3. **오류 처리**: 네트워크 오류나 AI 응답 실패시 기본 배너 제공
4. **배너 회전**: 복수 배너 자동 순환 표시

## 🎨 배너 예시

AI가 생성하는 배너 유형:
- **맛집**: 🍽️ "강남 맛집 - 현지인 추천 맛집에서 특별한 경험을"
- **카페**: ☕ "홍대 카페 - 인스타그램 핫플에서 여유로운 시간을"
- **관광**: 🗺️ "경복궁 투어 - 역사와 문화가 살아있는 특별한 장소"
- **쇼핑**: 🛍️ "명동 쇼핑 - 트렌디한 아이템과 함께하는 쇼핑"

## 🚨 문제 해결

### API 호출 실패
```
AI 배너 생성 실패: ApiException...
```
- Firebase 프로젝트에서 Vertex AI API가 활성화되었는지 확인
- 결제 설정이 올바르게 되어있는지 확인
- 인터넷 연결 상태 확인

### JSON 파싱 오류
```
JSON 파싱 실패: FormatException...
```
- AI 응답이 예상과 다른 형식일 때 발생
- 기본 배너로 자동 대체됨 (정상 동작)

### 배너가 표시되지 않는 경우
- 로그에서 "AI 배너 서비스 초기화 완료" 메시지 확인
- 채팅방 진입시 "배너 로딩 실패" 메시지 확인

## 💡 사용 팁

1. **비용 관리**: AI 호출은 유료이므로 캐싱을 활용
2. **응답 시간**: 첫 배너 로딩에 2-3초 소요 정상
3. **품질 관리**: AI 응답 품질이 일정하지 않을 수 있음
4. **오프라인**: 인터넷 연결없이도 기본 배너 제공

## 📊 비용 정보

Vertex AI Gemini 1.5 Flash 모델 기준:
- 입력 토큰: 1,000 토큰당 약 $0.075
- 출력 토큰: 1,000 토큰당 약 $0.30
- 배너 1개 생성당 약 200-300 토큰 사용 예상

월 1000개 배너 생성시 예상 비용: $5-10

## 🔄 향후 개선 사항

- [ ] 배너 클릭 통계 및 분석
- [ ] 사용자 관심사 기반 개인화
- [ ] 실제 업체 정보와 연동
- [ ] 배너 성과 측정 및 최적화
- [ ] 다국어 지원

---

📝 문의사항이나 버그 발견시 이슈로 등록해주세요! 